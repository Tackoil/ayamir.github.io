# jitter buffer学习理解


## jitter buffer是什么

在了解jitter buffer之前，我们应该先来看一下整个webrtc会话中数据传输的完整流程。

![image-20240418175944047](https://raw.githubusercontent.com/ayamir/blog-imgs/main/image-20240418175944047.png)

与传输相关的部分主要出现在Pacer和jitter buffer这两个部分，从图中可以清晰的看到这两者处于编解码和网络传输之间，考虑到编解码可能会引入突变的帧大小（比如I帧），而在网络传输的过程又受到网络传输速率和排队延迟的影响，所以它们的作用其实就比较显而易见了。Pacer在发送端负责平滑编码后的码流打包成rtp包之后，发送到网络上的速率；jitter buffer在接收端负责平滑接收到的rtp包到组成解码所需的码流的过程。

当然，这个传输的过程中离开不了拥塞控制算法如gcc和各种抗丢包的技术如nack，fec等来保障实时通信质量。在这里我们主要关注传输的流程，相关算法和机制之后再研究。

jitter buffer可以理解为有两部分的功能，一部分是Buffer的功能，也就是作为rtp包的缓冲区，并且将rtp包恢复成表示可解码帧的码流；另一部分是jitter的功能，也就是通过引入延迟来平滑因帧大小和网络状况而造成的接收帧不均匀的情况。

## buffer的工作流程

正如前面所说，网络传输的是rtp包，而解码器的输入是可以解码的码流，所以需要一个将rtp包转换成可以解码的帧的过程，因为一个帧由多个rtp包组成，所以肯定需要缓冲区来存放前面收到但是还不足以组成一个帧的rtp包，这个缓冲区在webrtc中其实就是`PacketBuffer`。此外，考虑到编解码原理，接收到的P帧还需要等它所依赖的I帧/P帧被解码，它才能被解码，所以在


